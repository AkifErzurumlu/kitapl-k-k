<%- include('layout') %>

<div class="row justify-content-center mt-4">
    <div class="col-md-6">
        <div class="card p-4 shadow-lg border-0">
            <h3 class="mb-4 text-center fw-bold" style="color: #667eea;">Yeni Kitap Ekle</h3>
            
            <form action="/add-book" method="POST">
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Kitap Adı</label>
                    <input type="text" id="bookTitle" name="title" class="form-control form-control-lg" placeholder="Kitap adını yazmaya başla..." list="bookSuggestions" required autocomplete="off">
                    
                    <datalist id="bookSuggestions">
                        <% library.forEach(book => { %>
                            <option value="<%= book.title %>"></option>
                        <% }) %>
                    </datalist>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Yazar Adı</label>
                    <input type="text" id="bookAuthor" name="author" class="form-control form-control-lg" placeholder="Yazar otomatik gelecek..." required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Kitap İçeriği / Hikaye</label>
                    <textarea name="content" class="form-control" rows="6" placeholder="Kitabın metnini, özetini veya hikayesini buraya yapıştır..."></textarea>
                    <div class="form-text">Buraya yapıştırdığın metni "Oku" modunda görebilirsin.</div>
                </div>
                <button type="submit" class="btn btn-success btn-lg w-100 mt-3 shadow-sm">
                    Kütüphaneye Kaydet
                </button>
                <a href="/list" class="btn btn-outline-secondary w-100 mt-2 border-0">Vazgeç</a>
            </form>

        </div>
    </div>
</div>

<script>
    // Server'dan gelen kitap listesini JavaScript'e aktarıyoruz
    const libraryData = <%- JSON.stringify(library) %>;
    
    const titleInput = document.getElementById('bookTitle');
    const authorInput = document.getElementById('bookAuthor');

    // Kullanıcı her harfe bastığında çalışır
    titleInput.addEventListener('input', function() {
        const selectedTitle = this.value;
        
        // Listede bu isimde bir kitap var mı diye bak
        const foundBook = libraryData.find(book => book.title === selectedTitle);

        // Varsa yazarı doldur
        if (foundBook) {
            authorInput.value = foundBook.author;
            authorInput.style.backgroundColor = "#d1e7dd"; // Yeşil yanar
        } else {
            authorInput.style.backgroundColor = ""; // Normale döner
        }
    });
</script>

</div> </body>
</html>